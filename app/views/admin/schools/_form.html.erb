<%= simple_form_for [:admin, @school], wrapper: :admin_form, html: {data: {'parsley-validate': true}} do |f| %>
    <%= f.error_notification %>
    <div class="form-body form-horizontal">
      <div class="form-group">
        <label class="col-md-2 control-label">学校logo：</label>
        <div class="col-sm-9">
          <%= webuploader_tag :logo_id, label: '上传学校logo', type: 'school_logo', asset: @school.logo, klass: 'single' %>
        </div>
      </div>
      <div class="form-group">
        <label class="col-md-2 control-label">学校地区：</label>
        <div class="col-sm-9">
          <div class="city-group">
            <%= select_tag 'school[province]', options_for_select(ChinaCity.list, @school.province.presence), prompt: '省份', class: "city-select" %>
            <%= select_tag 'school[city]', options_for_select(ChinaCity.list(@school.province.to_s), @school.city.presence), prompt: '城市', class: "city-select" %>
            <%= select_tag 'school[district]', options_for_select(ChinaCity.list(@school.city.to_s), @school.district.presence), prompt: '地区', class: "city-select" %>
          </div>
        </div>
      </div>
      <%= f.input :address, label: '详细地址：', autofocus: true, input_html: { data:{} } %>
      <%= f.input :name, label: '学校名称：', autofocus: true, input_html: { data: {'parsley-required': true}} %>
      <%= f.input :level, as: :radio_buttons, label: '学校等级：', collection: School.options_for_enum_select(:levels) %>
      <%= f.input :user_id, collection: [@school.user].compact.map {|u| [u.name, u.id]}, label: '指定校长用户：', prompt: "请选择用户", input_html: {class: 'user_selector'} %>
      <%= f.input :contact_phone, label: '校长联系方式：', autofocus: true, input_html: { data: {'parsley-required': true}} %>
      <%= f.input :contact_name, label: '联系人：', autofocus: true, input_html: { data: {'parsley-required': true}} %>
      <%= f.input :contact_position, label: '联系人职务：', autofocus: true, input_html: { data: {'parsley-required': true}} %>
      <div class="form-group">
        <label class="col-md-2 control-label">学校概况：</label>
        <div class="col-sm-9">
          <%= f.cktext_area :describe, input_html: { data: {}}  %>
        </div>
      </div>
      <%= f.input :kind, as: :radio_buttons, label: '学校性质：', collection: School.options_for_enum_select(:kinds) %>
    </div>
    <div class="form-actions">
      <div class="row">
        <div class="col-md-offset-3 col-md-9">
          <%= f.button :submit, '提交', class: 'btn green' %>
          <%= link_to '取消', admin_schools_path, class: 'btn' %>
        </div>
      </div>
    </div>
<% end %>
<script>
$(function(){
  initImageWebuploader($('#webuploader'));

  $("form .user_selector").select2({
    language: "zh-CN",
    placeholder: '请选择用户',
    allowClear: true,
    ajax: {
      url: "/selects/school_user",
      dataType: 'json',
      delay: 250,
      data: function (params) {
        return {
          q: params.term, // search term
          page: params.page
        };
      },
      processResults: function (data, params) {
        params.page = params.page || 1;
        return {
            results: $.map(data.items, function (item) {
              return {
                text: item.name,
                id: item.id
            }
          }),
          pagination: {
            more: (params.page * 30) < data.total_count
          }
        };
      },
      cache: true
    },
    minimumInputLength: 1
  });
})

</script>
