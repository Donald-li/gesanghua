<%= simple_form_for [:admin, @project], wrapper: :admin_form, html: {'data-parsley-validate': true, class: 'form-horizontal project_form'} do |f| %>
<%= f.error_notification %>
<div class="form-body">
  <%= f.input :name, label: '项目分类名称：', autofocus: true, placeholder: '', required: true %>
  <div class="form-group">
    <label class="col-md-2 control-label">项目封面：</label>
    <div class="col-sm-9">
      <%= webuploader_tag :image_id, label: '上传项目封面', type: 'project_image', asset: @project.image, klass: 'single' %>
    </div>
  </div>
  <div class="form-group">
    <label class="col-md-2 control-label">财务收入分类：</label>
    <div class="col-sm-9">
      <select id="fund" class="form-control select optional" name="project[fund_id]" required>
        <% FundCategory.directional.reverse_sorted.each do |fc| %>
        <optgroup label="<%= fc.name %>">
          <% fc.funds.restricted.each do |fund| %>
          <option value="<%= fund.id %>" <%= 'selected' if @project.fund_id == fund.id %>><%= fund.name %></option>
          <% end %>
        </optgroup>
        <% end %>
      </select>
    </div>
  </div>
  <%= f.input :describe, label: '项目分类描述：', required: true %>
  <div class="form-group">
    <label class="col-md-2 control-label">协议内容：</label>
    <div class="col-sm-9">
      <%= f.cktext_area :protocol %>
    </div>
  </div>
  <div class="form-group">
    <div id="form" class="form-inline">
      <% f.object.build_form if f.object.form.blank? %>
      <% f.object.form.each_with_index do |form_item, i| %>
        <div class="inline-group">
          <%= text_field_tag "project[form_attributes][#{i}][key]", form_item['key'], placeholder: '代码'%>
          <%= text_field_tag "project[form_attributes][#{i}][label]", form_item['label'], placeholder: '标签'%>
          <%= select_tag "project[form_attributes][#{i}][type]", options_for_select([['文本框', 'text'], ['多行文本框', 'textarea'], ['选项', 'select']], form_item['type']), placeholder: '代码'%>
          <label><%= check_box_tag "project[form_attributes][#{i}][required]", 'y', form_item['required']%>必填</label>
          <a href="#" class="destroy"><i class="fa fa-remove font-red-soft"></i></a>
        </div>
      <% end %>
    </div>
    <a class="btn btn-info btn-xs" href="#" id="add-form-item"><i class="fa fa-plus"></i> 添加表单项</a>
  </div>
</div>

<div class="form-actions">
  <div class="row">
    <div class="col-md-offset-2 col-md-9">
      <%= f.button :submit, '提交', class: 'btn blue' %>
      <%= link_to '取消', admin_projects_path, class: 'btn' %>
    </div>
  </div>
</div>
<% end %>
<script type="text/javascript">
$(function(){
  initImageWebuploader($('#webuploader'));
  //    表单验证
  $(".project_form").html5Validate(function(){
      $(this).find('[type="submit"]').attr('disabled','disabled');
      this.submit();
  });

  $("#fund").select2();
})

$("#form").nestedAttributes({
  bindAddTo: $("#add-form-item")
});
</script>
