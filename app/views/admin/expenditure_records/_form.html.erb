<%= simple_form_for [:admin, @expenditure_record], wrapper: :admin_form, html: {'data-parsley-validate': true, class: 'category_form'} do |f| %>
  <%= f.error_notification %>
  <div class="form-body form-horizontal">
    <%= f.input :name, label: '支出名称：', placeholder: '请填写支出名称', require: true %>
    <div class="form-group">
      <label class="col-md-2 control-label">支出时间：</label>
      <div class="col-sm-9">
        <%= f.text_field :expended_at, class: 'datetime-picker', placeholder: '支出时间', required: true %>
      </div>
    </div>
    <%= f.input :amount, label: '支出金额：', require: true, type: 'number' %>
    <div class="form-group">
      <label class="col-md-2 control-label">支出分类：</label>
      <div class="col-sm-9">
        <select id="fund" class="form-control select optional" name="expenditure_record[fund_id]" required>
          <% FundCategory.reverse_sorted.each do |fc| %>
              <% fc.funds.each do |fund| %>
                  <option value="<%= fund.id %>" <%= 'selected' if @expenditure_record.fund_id == fund.id %>><%= fc.name %> - <%= fund.name %></option>
              <% end %>
          <% end %>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-md-2 control-label">支出凭证图片：</label>
      <div class="col-sm-9">
        <%= webuploader_tag 'image_ids[]', label: '上传凭证图片', type: 'expenditure_record_image', asset: @expenditure_record.images %>
      </div>
    </div>
    <%= f.input :operator, label: '经办人：', placeholder: '请填写支出经办人' %>
    <%= f.input :remark, label: '备注：', placeholder: '备注' %>
  </div>
  <div class="form-actions">
    <div class="row">
      <div class="col-md-offset-2 col-md-9">
        <%= f.button :submit, '提交', class: 'btn blue' %>
        <%= link_to '取消', admin_expenditure_records_path, class: 'btn' %>
      </div>
    </div>
  </div>
<% end %>

<script>
    $(function(){
        $(".category_form").parsley().on('form:submit', function () {
            var ima_length = document.getElementById("webuploader").getElementsByTagName("li").length;
            if (ima_length <= 1) {
                alert("请上传凭证");
                return false;
            }
            return true;
        })

        $("#fund").select2({
            language: "zh-CN"
        });
        initMultiImageWebuploader($('#webuploader'));
        $('.upload-list').viewer();

        // 异步加载入账列表
        // $('.income-ajax').select2({
        //     language: "zh-CN",
        //     placeholder: '请选择支出的入账记录',
        //     allowClear: true,
        //     ajax: {
        //         url: "/selects/income_records",
        //         dataType: 'json',
        //         delay: 250,
        //         data: function (params) {
        //             return {
        //                 q: params.term, // search term
        //                 page: params.page
        //             };
        //         },
        //         processResults: function (data, params) {
        //             params.page = params.page || 1;
        //             return {
        //                 results: $.map(data.items, function (item) {
        //                     return {
        //                         text: item.name,
        //                         id: item.id
        //                     }
        //                 }),
        //                 pagination: {
        //                     more: (params.page * 30) < data.total_count
        //                 }
        //             };
        //         },
        //         cache: true
        //     }
        // });
    })
</script>
