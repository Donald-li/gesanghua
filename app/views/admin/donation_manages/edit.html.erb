<div class="portlet light bordered">
  <div class="portlet-title">
    <div class="caption">
      <i class="icon-note"></i>
      <span class="caption-subject">修改捐助</span>
      <span class="caption-helper"></span>
    </div>
    <div class="actions">
      <div class="portlet-input input-inline input-small">
        <div class="input-icon right">
        </div>
      </div>
    </div>
  </div>
  <div class="portlet-body form">
    <%= simple_form_for [:admin, @donation], url: admin_donation_manage_path, wrapper: :admin_form, html: {'data-parsley-validate': true, class: 'form-horizontal donation_form'} do |f| %>
        <%= f.error_notification %>
        <div class="form-body">
          <%= f.input :name, label: '捐助名称：', autofocus: true, placeholder: '', required: true %>
          <div class="form-group">
            <label class="col-md-2 control-label">捐助Logo：</label>
            <div class="col-sm-9">
              <%= webuploader_tag :logo_id, label: '上传捐助Logo', type: 'donation_logo', asset: @donation.logo, klass: 'single' %>
            </div>
          </div>
          <%= f.input :describe, label: '捐助说明：', placeholder: '说明该款项用途' %>
          <div class="form-group">
            <label class="col-md-2 control-label">捐助收入分类：</label>
            <div class="col-sm-9">
              <select id="fund" class="form-control select optional" name="donation[fund_id]" required>
                <% FundCategory.sorted.each do |fc| %>
                    <% fc.funds.each do |fund| %>
                        <option value="<%= fund.id %>" <%= 'selected' if @donation.fund_id == fund.id %>><%= fc.name %> - <%= fund.name %></option>
                    <% end %>
                <% end %>
              </select>
            </div>
          </div>
          <%= f.input :state, as: :radio_buttons, wrapper: :inline_inputs, collection: Donation.options_for_enum_select(:states), label: '状态：', input_html: {data: {'parsley-required': true}} %>
          <div class="form-actions">
            <div class="row">
              <div class="col-md-offset-2 col-md-9">
                <%= f.button :submit, '提交', class: 'btn blue' %>
                <%= link_to '取消', admin_donation_manages_path, class: 'btn' %>
              </div>
            </div>
          </div>
    <% end %>
    </div>
  </div>
</div>
<script type="text/javascript">
    $(function () {
        initImageWebuploader($('#webuploader'));
        //    表单验证
        $(".donation_form").html5Validate(function () {
            $(this).find('[type="submit"]').attr('disabled', 'disabled');
            this.submit();
        });

        $("#fund").select2({
            language: "zh-CN"
        });
    })

    $("#form").nestedAttributes({
        bindAddTo: $("#add-form-item")
    });
</script>
