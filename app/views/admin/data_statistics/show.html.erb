<div class="row">
  <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="dashboard-stat blue">
      <div class="visual">
        <i class="fa fa-comments"></i>
      </div>
      <div class="details">
        <div class="number">
          <span data-counter="counterup" data-value="<%= @user_count %>"><%= @user_count %></span>
        </div>
        <div class="desc"> 注册用户</div>
      </div>
      <a class="more" href="<%= admin_users_path %>"> 查看
        <i class="m-icon-swapright m-icon-white"></i>
      </a>
    </div>
  </div>
  <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="dashboard-stat red">
      <div class="visual">
        <i class="fa fa-bar-chart-o"></i>
      </div>
      <div class="details">
        <div class="number">
          <span data-counter="counterup" data-value="<%= @volunteer_count %>"><%= @volunteer_count %></span>
        </div>
        <div class="desc"> 志愿者人数</div>
      </div>
      <a class="more" href="<%= admin_volunteers_path %>"> 查看
        <i class="m-icon-swapright m-icon-white"></i>
      </a>
    </div>
  </div>
  <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="dashboard-stat green">
      <div class="visual">
        <i class="fa fa-shopping-cart"></i>
      </div>
      <div class="details">
        <div class="number">
          <span data-counter="counterup" data-value="<%= @donate_record %>"><%= @donate_record %></span>
        </div>
        <div class="desc"> 捐助次数</div>
      </div>
      <a class="more" href="<%= admin_income_records_path %>"> 查看
        <i class="m-icon-swapright m-icon-white"></i>
      </a>
    </div>
  </div>
  <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="dashboard-stat purple">
      <div class="visual">
        <i class="fa fa-globe"></i>
      </div>
      <div class="details">
        <div class="number"> ￥
          <span data-counter="counterup" data-value="<%= @income_count %>"><%= @income_count %></span>
        </div>
        <div class="desc"> 累计捐助金额</div>
      </div>
      <a class="more" href="<%= admin_income_records_path %>"> 查看
        <i class="m-icon-swapright m-icon-white"></i>
      </a>
    </div>
  </div>
</div>

<div class="portlet light">
  <div class="portlet-title">
    <div class="caption">
      <i class="icon-list"></i>
      用户注册
    </div>
    <div class="actions">
      <div class="statistic-pull-left">
      <div class="btn-group statistic-pull-left" style="margin-right: 30px;">
        <a class="btn btn-default grey dropdown-toggle" data-toggle="dropdown" href="javascript:;" aria-expanded="false">
          <i class="fa fa-calendar"></i>
            时间跨度设置
          <i class="fa fa-angle-down"></i>
        </a>
        <ul class="dropdown-menu">
          <li>
            <a onclick="getUserStatisticData('week')" >
              本周
            </a>
          </li>
          <li>
            <a onclick="getUserStatisticData('month')" >
              本月
            </a>
          </li>
          <li>
            <a onclick="getUserStatisticData('year')" >
              本年
            </a>
          </li>
        </ul>
      </div>

        <label class="statistic-pull-left" style="margin-top: 6px;">时间范围：</label>
        <div class="col-sm-3 statistic-form-input">
          <input class="form-control datepicker" id="start_time" placeholder="开始时间">
        </div>
        <div class="col-sm-3 statistic-form-input">
          <input class="form-control datepicker" id="end_time" placeholder="结束时间">
        </div>
      </div>
      <button class="btn btn-default grey" onclick="getUserStatisticData()">确认</button>
    </div>
  </div>
  <div class="portlet-body">
    <div class="dataTables_wrapper no-footer">

      <div id="user-register-chart" style="width: auto; height: 400px;"></div>
      <p class="help-block">默认显示本月数据</p>
    </div>
  </div>
</div>


<div class="portlet light">
  <div class="portlet-title">
    <div class="caption">
      <i class="icon-list"></i>
      筹款金额
    </div>
    <div class="actions">
      <div class="statistic-pull-left">
        <div class="btn-group statistic-pull-left" style="margin-right: 30px;">
          <a class="btn btn-default grey dropdown-toggle" data-toggle="dropdown" href="javascript:;" aria-expanded="false">
            <i class="fa fa-calendar"></i>
              时间跨度设置
            <i class="fa fa-angle-down"></i>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a onclick="getIncomeStatisticData('week')" >
                本周
              </a>
            </li>
            <li>
              <a onclick="getIncomeStatisticData('month')" >
                本月
              </a>
            </li>
            <li>
              <a onclick="getIncomeStatisticData('year')" >
                本年
              </a>
            </li>
          </ul>
        </div>

        <label class="statistic-pull-left" style="margin-top: 6px;">时间范围：</label>
        <div class="col-sm-3 statistic-form-input">
          <input class="form-control datepicker" id="income_start_time" placeholder="开始时间">
        </div>
        <div class="col-sm-3 statistic-form-input">
          <input class="form-control datepicker" id="income_end_time" placeholder="结束时间">
        </div>
      </div>
      <button class="btn btn-default grey" onclick="getIncomeStatisticData()">确认</button>
    </div>
  </div>
  <div class="portlet-body">
    <div class="dataTables_wrapper no-footer">

      <div id="income-statistic-chart" style="width: auto; height: 400px;"></div>
      <p class="help-block">默认显示本月数据</p>
    </div>
  </div>
</div>

<script src="/admin/assets/global/plugins/counterup/jquery.counterup.js" type="text/javascript"></script>
<script src="/admin/assets/global/plugins/counterup/jquery.waypoints.min.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
    $('.counter').counterUp({
        delay: 5,
        time: 100
    });

    var userChart = echarts.init(document.getElementById('user-register-chart'));
    var incomeChart = echarts.init(document.getElementById('income-statistic-chart'));
    getUserStatisticData()
    getIncomeStatisticData()

    function getUserStatisticData (val) {
        $.ajax({
            url: '/ajaxes/user_statistics',
            type: 'get',
            data: {
                time_span: val,
                start_time: $('#start_time').val(),
                end_time:$('#end_time').val()
            },
            success:function(result){
                xlist = result.keys
                ylist = result.values
                userChart.setOption({
                    title: {
                        // text: '注册人数',
                        // subtext: ''
                    },
                    tooltip: {
                        triggerOn: 'onmousemove',
                        formatter: function(params) {
                            return params.name + ' 注册人数: ' + params.value;
                        }
                    },
                    xAxis: {
                        name: '日期',
                        type: 'category',
                        boundaryGap: false,
                        data: xlist,
                        axisPointer: true
                    },
                    yAxis: {
                        name: '注册人数',
                        type: 'value',
                        minInterval: 1,
                        axisLabel: {
                            formatter: '{value} 人'
                        }
                    },
                    series: [
                        {
                            name: '注册人数',
                            type: 'line',
                            data: ylist,
                            markLine: {
                                data: [
                                    {type: 'average', name: '日均'}
                                ]
                            }
                        }
                    ]
                })
            }
        })
    }

    function getIncomeStatisticData (val) {
        $.ajax({
            url: '/ajaxes/income_statistics',
            type: 'get',
            data: {
                time_span: val,
                start_time: $('#income_start_time').val(),
                end_time:$('#income_end_time').val()
            },
            success:function(result){
                xlist = result.keys
                ylist = result.values
                incomeChart.setOption({
                    title: {
                        // text: '注册人数',
                        // subtext: ''
                    },
                    tooltip: {
                        triggerOn: 'mousemove',
                        formatter: function(params) {
                            return params.name + ' 筹款金额: ' + params.value;
                        }
                    },
                    xAxis: {
                        name: '日期',
                        type: 'category',
                        boundaryGap: false,
                        data: xlist,
                        axisPointer: true
                    },
                    yAxis: {
                        name: '筹款金额',
                        type: 'value',
                        minInterval: 1,
                        axisLabel: {
                            formatter: '{value} 元'
                        }
                    },
                    series: [
                        {
                            name: '筹款金额',
                            type: 'line',
                            data: ylist,
                            markLine: {
                                data: [
                                    {type: 'average', name: '日均'}
                                ]
                            }
                        }
                    ]
                })
            }
        })
    }

</script>